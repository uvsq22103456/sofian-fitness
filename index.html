<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FITNESS CLEAN | V20</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&display=swap');
        
        :root { 
            --bg: #F9FAFB; /* Gris tr√®s tr√®s clair (presque blanc) */
            --card: #FFFFFF;
            --text: #1F2937;
            --gray: #9CA3AF;
            --primary: #EC4899; /* Rose Siana */
            --primary-light: #FCE7F3;
            --input-border: #F3F4F6;
        }

        body.theme-mel { 
            --primary: #8B5CF6; /* Violet Mel */
            --primary-light: #EDE9FE;
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: var(--bg); 
            color: var(--text); 
            height: 100dvh; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column;
            transition: background 0.3s;
        }
        
        .view-container { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 140px; }
        
        /* CARTES CLEAN */
        .card { 
            background: var(--card); 
            border-radius: 24px; 
            padding: 20px; 
            box-shadow: 0 4px 20px -5px rgba(0,0,0,0.05); /* Ombre tr√®s douce */
            margin-bottom: 16px;
            border: 1px solid white;
        }

        /* INPUTS "BUBBLY" (Gros & Ronds) */
        input, select { 
            background: #F3F4F6; 
            border: 2px solid transparent; 
            padding: 14px; 
            border-radius: 18px; 
            width: 100%; 
            outline: none; 
            font-weight: 700; 
            font-size: 15px;
            color: #374151;
            transition: 0.2s;
        }
        input:focus, select:focus { 
            background: white;
            border-color: var(--primary); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        input::placeholder { color: #D1D5DB; font-weight: 500; }

        /* BOUTONS */
        .btn-main {
            background: var(--primary); color: white;
            padding: 16px; border-radius: 20px; width: 100%;
            font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;
            box-shadow: 0 8px 15px -3px var(--primary-light);
            transition: 0.2s;
        }
        .btn-main:active { transform: scale(0.97); }

        /* CALENDRIER SEMAINE */
        .cal-day { 
            aspect-ratio: 0.75; 
            background: white; 
            border-radius: 16px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border: 2px solid transparent; 
            transition: all 0.2s; cursor: pointer; position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        .cal-day.selected { border-color: var(--primary); background: var(--primary-light); transform: translateY(-3px); }
        .cal-day.today { background: var(--primary); color: white; box-shadow: 0 4px 10px var(--primary-light); }
        
        .plan-badge {
            width: 6px; height: 6px; border-radius: 50%; background: var(--primary);
            position: absolute; bottom: 8px;
        }
        .today .plan-badge { background: white; }

        /* CHIPS (Boutons choix rapides) */
        .chip {
            background: white; border: 1px solid #E5E7EB;
            padding: 8px 12px; border-radius: 20px; 
            font-size: 11px; font-weight: 700; color: #4B5563;
            cursor: pointer; transition: 0.2s;
        }
        .chip:active { background: var(--primary); color: white; border-color: var(--primary); }

        /* NAV BAR FLOTTANTE */
        .nav-bar {
            position: fixed; bottom: 24px; left: 24px; right: 24px;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px);
            border-radius: 30px; padding: 12px;
            display: grid; grid-template-columns: 3fr; 
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.1);
            z-index: 50; border: 1px solid rgba(255,255,255,0.5);
        }
        .nav-item { text-align: center; opacity: 0.4; transition: 0.3s; font-size: 24px; }
        .nav-active { opacity: 1; color: var(--primary); transform: scale(1.1); }

        .hidden { display: none; }
    </style>
</head>
<body class="theme-siana">

    <header class="pt-12 px-6 flex justify-between items-center bg-white/50 backdrop-blur-sm pb-4 sticky top-0 z-40">
        <div>
            <h1 class="text-2xl font-black tracking-tight text-gray-800">FIT DUO</h1>
            <p class="text-[11px] uppercase font-bold text-gray-400" id="header-date">Chargement...</p>
        </div>
        <div class="bg-white p-1 rounded-full shadow-sm flex gap-1 border border-gray-100">
            <button onclick="switchUser('siana')" id="btn-siana" class="w-9 h-9 rounded-full flex items-center justify-center text-lg transition bg-pink-50">üë©üèΩ</button>
            <button onclick="switchUser('mel')" id="btn-mel" class="w-9 h-9 rounded-full flex items-center justify-center text-lg transition opacity-30">üë©üèª</button>
        </div>
    </header>

    <main class="view-container">

        <section id="view-dashboard">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-4 px-2">
                    <button onclick="changeWeek(-1)" class="text-2xl text-gray-300 hover:text-gray-600">‚Äπ</button>
                    <span id="week-label" class="text-xs font-bold uppercase tracking-widest text-gray-400">...</span>
                    <button onclick="changeWeek(1)" class="text-2xl text-gray-300 hover:text-gray-600">‚Ä∫</button>
                </div>
                <div class="grid grid-cols-7 gap-2" id="week-grid"></div>
            </div>

            <div class="card relative overflow-hidden">
                <div class="absolute top-0 left-0 w-1.5 h-full" style="background: var(--primary)"></div>
                <div class="flex justify-between items-start pl-2">
                    <div>
                        <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Aujourd'hui</div>
                        <div id="plan-display" class="text-2xl font-black italic uppercase text-gray-800">REPOS</div>
                    </div>
                    <button onclick="openPlanModal()" class="bg-gray-50 p-2 rounded-xl text-lg hover:bg-gray-100 transition">‚úèÔ∏è</button>
                </div>
                
                <button onclick="duplicateLastWeek()" class="w-full mt-4 text-[10px] font-bold uppercase text-gray-400 border-t border-dashed border-gray-200 pt-3 hover:text-gray-600">
                    ‚ö°Ô∏è Copier la semaine derni√®re
                </button>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="card !mb-0 flex flex-col items-center justify-center !p-4">
                    <div class="text-[10px] font-bold text-gray-400 uppercase mb-2">Eau</div>
                    <div class="flex items-center gap-2">
                        <button onclick="modWater(-0.5)" class="text-gray-300 font-bold text-xl px-2">-</button>
                        <div class="text-xl font-black" style="color:var(--primary)"><span id="water-val">0</span>L</div>
                        <button onclick="modWater(0.5)" class="text-gray-300 font-bold text-xl px-2">+</button>
                    </div>
                </div>
                
                <button onclick="nav('workout', document.getElementById('nav-sport'))" class="btn-main !mb-0 flex flex-col items-center justify-center !shadow-none !p-0">
                    <span class="text-2xl mb-1">üí™</span>
                    <span class="text-[10px]">NOTER</span>
                </button>
            </div>

            <div class="card">
                <h3 class="text-[11px] font-bold uppercase text-gray-400 mb-3">Mes Objectifs</h3>
                <div id="goals-list" class="space-y-2 mb-3"></div>
                
                <div class="flex gap-2">
                    <input type="text" id="new-goal" placeholder="Nouveau..." class="!py-2 !text-sm">
                    <button onclick="addGoal()" class="bg-gray-800 text-white w-10 rounded-xl font-bold">+</button>
                </div>
            </div>

            <h3 class="text-[11px] font-bold uppercase text-gray-400 ml-4 mb-2">S√©ance du jour</h3>
            <div id="history-list" class="space-y-3 pb-4"></div>
        </section>

        <section id="view-workout" class="hidden">
            <div class="flex bg-white p-1.5 rounded-[24px] shadow-sm mb-6 border border-gray-100">
                <button onclick="setMode('muscu')" id="tab-muscu" class="flex-1 py-3 rounded-[20px] text-xs font-bold uppercase bg-gray-100 transition">üèãÔ∏è Muscu</button>
                <button onclick="setMode('cardio')" id="tab-cardio" class="flex-1 py-3 rounded-[20px] text-xs font-bold uppercase text-gray-400 transition">üèÉ Cardio</button>
            </div>

            <div id="form-muscu" class="space-y-4">
                <div id="suggestions" class="flex flex-wrap gap-2 mb-2 hidden px-1"></div>
                
                <div class="card space-y-4">
                    <label class="text-[10px] font-bold uppercase text-gray-400 ml-1">Exercice</label>
                    <input type="text" id="m-name" placeholder="Ex: Hip Thrust">
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] font-bold uppercase text-gray-400 ml-1">Type</label>
                            <select id="m-type" onchange="toggleWeight()">
                                <option value="Constant">Constant</option>
                                <option value="Progressif">Progressif ‚Üó</option>
                                <option value="D√©gressif">D√©gressif ‚Üò</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-[10px] font-bold uppercase text-gray-400 ml-1">S√©ries</label>
                            <input type="number" id="m-sets" placeholder="4" class="text-center">
                        </div>
                    </div>

                    <div class="flex items-center gap-2">
                        <div class="flex-1">
                            <label class="text-[10px] font-bold uppercase text-gray-400 ml-1">Poids (kg)</label>
                            <input type="number" id="m-w1" placeholder="0" class="text-center text-lg" style="color:var(--primary)">
                        </div>
                        <span id="arrow" class="hidden font-black text-gray-300 text-lg mt-4">‚ûú</span>
                        <div id="w2-box" class="flex-1 hidden">
                            <label class="text-[10px] font-bold uppercase text-gray-400 ml-1">Fin</label>
                            <input type="number" id="m-w2" placeholder="0" class="text-center text-lg" style="color:var(--primary)">
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] font-bold uppercase text-gray-400 ml-1">R√©p√©titions</label>
                        <input type="number" id="m-reps" placeholder="10" class="text-center">
                    </div>
                </div>
                <button onclick="addLog('muscu')" class="btn-main">Valider</button>
            </div>

            <div id="form-cardio" class="hidden space-y-4">
                <div class="card space-y-4">
                    <label class="text-[10px] font-bold uppercase text-gray-400 ml-1">Activit√©</label>
                    <input type="text" id="c-name" placeholder="Ex: Tapis">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] font-bold uppercase text-gray-400 ml-1">Temps (min)</label>
                            <input type="number" id="c-time" placeholder="30" class="text-center">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold uppercase text-gray-400 ml-1">Distance (km)</label>
                            <input type="number" id="c-dist" placeholder="0" class="text-center">
                        </div>
                    </div>
                </div>
                <button onclick="addLog('cardio')" class="btn-main">Valider</button>
            </div>
        </section>

        <section id="view-body" class="hidden">
            <div class="card space-y-4">
                <h3 class="text-xs font-bold uppercase text-gray-400">Mesures</h3>
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="b-weight" placeholder="Poids (kg)" class="text-center">
                    <input type="number" id="b-waist" placeholder="Taille (cm)" class="text-center">
                    <input type="number" id="b-glutes" placeholder="Fessier (cm)" class="text-center">
                    <input type="number" id="b-legs" placeholder="Cuisses (cm)" class="text-center">
                </div>
                <button onclick="addBodyLog()" class="btn-main">Sauvegarder</button>
            </div>
            
            <div class="card !p-4">
                <h3 class="text-[10px] font-bold uppercase text-gray-400 mb-4">Progression Poids</h3>
                <div class="h-40 w-full"><canvas id="bodyChart"></canvas></div>
            </div>
            <div id="body-list" class="space-y-2 pb-6"></div>
        </section>

    </main>

    <div id="modal-plan" class="fixed inset-0 bg-white/95 z-[100] hidden flex items-center justify-center p-6 backdrop-blur-md">
        <div class="w-full max-w-xs text-center">
            <h3 class="font-bold uppercase mb-8 text-gray-400 text-xs tracking-[0.2em]">Planning du jour</h3>
            
            <input type="text" id="plan-input" placeholder="Rien..." class="w-full text-center text-3xl font-black mb-8 border-b-2 border-gray-100 pb-2 bg-transparent outline-none" style="color:var(--primary)">
            
            <div class="flex flex-wrap justify-center gap-3 mb-10">
                <button onclick="setPlan('LEG DAY')" class="chip">LEG DAY</button>
                <button onclick="setPlan('GLUTES')" class="chip">GLUTES</button>
                <button onclick="setPlan('PUSH')" class="chip">PUSH</button>
                <button onclick="setPlan('PULL')" class="chip">PULL</button>
                <button onclick="setPlan('CARDIO')" class="chip">CARDIO</button>
                <button onclick="setPlan('REPOS')" class="chip">REPOS</button>
            </div>

            <div class="flex gap-4">
                <button onclick="closeModal()" class="flex-1 py-4 font-bold text-xs uppercase bg-gray-100 rounded-2xl text-gray-500">Annuler</button>
                <button onclick="savePlan()" class="flex-1 py-4 font-bold text-xs uppercase text-white rounded-2xl shadow-lg" style="background: var(--primary)">Valider</button>
            </div>
        </div>
    </div>

    <nav class="nav-bar">
        <button onclick="nav('dashboard', this)" class="nav-item nav-active">üìÖ</button>
        <button onclick="nav('workout', this)" id="nav-sport" class="nav-item">üí™</button>
        <button onclick="nav('body', this)" class="nav-item">üìè</button>
    </nav>

    <script>
        // CONFIG
        const DB_KEY = 'fit_v20_clean';
        let db = {
            siana: { logs: [], plans: {}, body: [], water: {}, goals: {} },
            mel: { logs: [], plans: {}, body: [], water: {}, goals: {} },
            lastUser: 'siana'
        };
        let curUser = 'siana';
        let viewDate = getMonday(new Date()); 
        let selDate = new Date().toISOString().split('T')[0];
        let chartInst = null;

        const SUGGESTIONS = {
            'LEG': ['Squat', 'Hip Thrust', 'Fentes', 'Presse'],
            'GLUTE': ['Hip Thrust', 'Kickback', 'Abductions', 'Fentes'],
            'PUSH': ['Dev Couch√©', '√âl√©vations', 'Triceps'],
            'PULL': ['Tractions', 'Rowing', 'Curl']
        };

        // INIT
        const saved = localStorage.getItem(DB_KEY);
        if(saved) db = JSON.parse(saved);
        switchUser(db.lastUser);

        // CORE
        function save() { localStorage.setItem(DB_KEY, JSON.stringify(db)); render(); }
        
        function switchUser(u) {
            curUser = u; db.lastUser = u;
            document.body.className = u === 'siana' ? 'theme-siana' : 'theme-mel';
            document.getElementById('btn-siana').style.opacity = u==='siana'?1:0.3;
            document.getElementById('btn-mel').style.opacity = u==='mel'?1:0.3;
            save(); updateChart();
        }

        function getMonday(d) {
            d = new Date(d); const day = d.getDay(), diff = d.getDate() - day + (day == 0 ? -6:1); 
            return new Date(d.setDate(diff));
        }

        function changeWeek(n) { viewDate.setDate(viewDate.getDate() + (n*7)); render(); }

        function render() {
            // Header
            document.getElementById('header-date').innerText = new Date(selDate).toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});

            // Calendar
            const grid = document.getElementById('week-grid'); grid.innerHTML = '';
            const end = new Date(viewDate); end.setDate(viewDate.getDate()+6);
            document.getElementById('week-label').innerText = `${viewDate.getDate()} - ${end.getDate()} ${end.toLocaleDateString('fr-FR',{month:'short'})}`;

            for(let i=0; i<7; i++) {
                let d = new Date(viewDate); d.setDate(viewDate.getDate()+i);
                const dStr = d.toISOString().split('T')[0];
                const plan = db[curUser].plans[dStr];
                
                const div = document.createElement('div');
                div.className = `cal-day ${dStr===selDate?'selected':''} ${dStr===new Date().toISOString().split('T')[0]?'today':''}`;
                div.innerHTML = `
                    <span class="text-[9px] font-bold opacity-40 mb-1">${d.toLocaleDateString('fr-FR',{weekday:'short'})}</span>
                    <span class="text-lg font-black">${d.getDate()}</span>
                    ${plan ? '<div class="plan-badge"></div>' : ''}
                `;
                div.onclick = () => { selDate = dStr; render(); suggestExos(); };
                grid.appendChild(div);
            }

            // Plan
            const p = db[curUser].plans[selDate];
            document.getElementById('plan-display').innerText = p || 'Repos';
            document.getElementById('plan-display').style.color = p ? 'var(--primary)' : '#9CA3AF';

            // Water
            document.getElementById('water-val').innerText = (db[curUser].water[selDate] || 0);

            // Goals
            const gList = document.getElementById('goals-list'); gList.innerHTML = '';
            const goals = db[curUser].goals[selDate] || [];
            if(goals.length === 0) gList.innerHTML = '<div class="text-xs text-gray-300 italic mb-2">Aucun objectif...</div>';
            
            goals.forEach((g, i) => {
                gList.innerHTML += `
                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl mb-2 cursor-pointer ${g.done?'opacity-50':''}" onclick="toggleGoal(${i})">
                    <div class="w-5 h-5 rounded border-2 border-gray-300 flex items-center justify-center text-xs text-white ${g.done?'bg-green-400 border-green-400':''}">${g.done?'‚úì':''}</div>
                    <span class="text-sm font-bold text-gray-600 ${g.done?'line-through':''}">${g.txt}</span>
                </div>`;
            });

            // History
            const hList = document.getElementById('history-list'); hList.innerHTML = '';
            const logs = db[curUser].logs.filter(l => l.d === selDate);
            if(logs.length === 0) hList.innerHTML = '<div class="text-center text-xs text-gray-300 italic py-4">Rien enregistr√©</div>';
            
            logs.forEach(l => {
                let desc = l.type === 'muscu' ? `<span style="color:var(--primary)">${l.w}</span> ‚Ä¢ ${l.s} x ${l.r}` : `${l.time}min ‚Ä¢ ${l.dist}km`;
                hList.innerHTML += `
                <div class="card !p-4 !mb-2 flex justify-between items-center relative">
                    <div>
                        <div class="text-[9px] font-black uppercase text-gray-300 mb-1">${l.mode||l.type}</div>
                        <div class="font-bold text-sm uppercase text-gray-700">${l.name}</div>
                        <div class="text-xs font-bold text-gray-400 mt-1">${desc}</div>
                    </div>
                    <button onclick="delLog(${l.id})" class="text-gray-300 hover:text-red-400 px-2 text-xl">√ó</button>
                </div>`;
            });

            // Body
            document.getElementById('body-list').innerHTML = db[curUser].body.slice(0,3).map(b => `<div class="bg-white p-3 rounded-xl text-xs flex justify-between items-center shadow-sm text-gray-500 font-bold mb-2"><span>${b.d}</span> <span class="text-black text-sm">${b.w} kg</span></div>`).join('');
        }

        // ACTIONS
        function openPlanModal() { document.getElementById('modal-plan').classList.remove('hidden'); document.getElementById('plan-input').value = db[curUser].plans[selDate]||''; }
        function closeModal() { document.getElementById('modal-plan').classList.add('hidden'); }
        function setPlan(t) { document.getElementById('plan-input').value = t; }
        function savePlan() { const v = document.getElementById('plan-input').value; if(v) db[curUser].plans[selDate]=v; else delete db[curUser].plans[selDate]; closeModal(); save(); }
        
        function duplicateLastWeek() {
            if(!confirm("Copier S-1 ?")) return;
            const prev = new Date(viewDate); prev.setDate(viewDate.getDate()-7);
            for(let i=0; i<7; i++) {
                let s = new Date(prev); s.setDate(prev.getDate()+i); let t = new Date(viewDate); t.setDate(viewDate.getDate()+i);
                let sStr = s.toISOString().split('T')[0]; let tStr = t.toISOString().split('T')[0];
                if(db[curUser].plans[sStr]) db[curUser].plans[tStr] = db[curUser].plans[sStr];
            }
            save(); alert("Copi√© !");
        }

        function modWater(v) { let c = db[curUser].water[selDate]||0; db[curUser].water[selDate] = Math.max(0, c+v); save(); }
        function addGoal() { const t = document.getElementById('new-goal').value; if(!t) return; if(!db[curUser].goals[selDate]) db[curUser].goals[selDate]=[]; db[curUser].goals[selDate].push({txt:t, done:false}); document.getElementById('new-goal').value=''; save(); }
        function toggleGoal(i) { db[curUser].goals[selDate][i].done = !db[curUser].goals[selDate][i].done; save(); }

        function nav(v, btn) {
            document.querySelectorAll('section').forEach(s=>s.classList.add('hidden')); document.getElementById('view-'+v).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('nav-active')); btn.classList.add('nav-active');
            if(v==='workout') suggestExos();
        }

        // SPORT LOGIC
        function setMode(m) {
            document.getElementById('form-muscu').classList.add('hidden'); document.getElementById('form-cardio').classList.add('hidden');
            document.getElementById('tab-muscu').style.color = m==='muscu'?'#111827':'#9CA3AF';
            document.getElementById('tab-cardio').style.color = m==='cardio'?'#111827':'#9CA3AF';
            document.getElementById('tab-muscu').style.background = m==='muscu'?'#F3F4F6':'white';
            document.getElementById('tab-cardio').style.background = m==='cardio'?'#F3F4F6':'white';
            document.getElementById('form-'+m).classList.remove('hidden');
        }

        function toggleWeight() {
            const t = document.getElementById('m-type').value;
            if(t === 'Constant') { document.getElementById('w2-box').classList.add('hidden'); document.getElementById('arrow').classList.add('hidden'); } 
            else { document.getElementById('w2-box').classList.remove('hidden'); document.getElementById('arrow').classList.remove('hidden'); }
        }

        function suggestExos() {
            const box = document.getElementById('suggestions'); box.innerHTML = '';
            const plan = db[curUser].plans[selDate];
            if(!plan) { box.classList.add('hidden'); return; }
            let list = [];
            for(const [k, v] of Object.entries(SUGGESTIONS)) { if(plan.toUpperCase().includes(k)) list = [...list, ...v]; }
            if(list.length) { box.classList.remove('hidden'); list.forEach(e => { const c = document.createElement('div'); c.className='chip'; c.innerText=e; c.onclick = () => document.getElementById('m-name').value = e; box.appendChild(c); }); } 
            else box.classList.add('hidden');
        }

        function addLog(type) {
            const id = Date.now();
            if(type === 'muscu') {
                const name = document.getElementById('m-name').value; if(!name) return;
                const w1 = document.getElementById('m-w1').value; const w2 = document.getElementById('m-w2').value;
                const s = document.getElementById('m-sets').value; const r = document.getElementById('m-reps').value;
                const mode = document.getElementById('m-type').value;
                let wDisplay = w1 + 'kg'; if(mode !== 'Constant' && w2) wDisplay = `${w1}‚ûú${w2}kg`;
                db[curUser].logs.unshift({ id, d: selDate, type: 'muscu', name, w: wDisplay, s, r, mode });
            } else {
                const name = document.getElementById('c-name').value; if(!name) return;
                const t = document.getElementById('c-time').value; const d = document.getElementById('c-dist').value;
                db[curUser].logs.unshift({ id, d: selDate, type: 'cardio', name, time: t, dist: d });
            }
            save();
        }

        function addBodyLog() { const w = document.getElementById('b-weight').value; if(!w) return; db[curUser].body.unshift({ d: selDate, w }); save(); updateChart(); }
        function delLog(id) { if(confirm("Supprimer ?")) { db[curUser].logs = db[curUser].logs.filter(l => l.id !== id); save(); } }

        function updateChart() {
            const ctx = document.getElementById('bodyChart'); if(chartInst) chartInst.destroy();
            const data = db[curUser].body.sort((a,b)=>a.d.localeCompare(b.d));
            chartInst = new Chart(ctx, {
                type: 'line',
                data: { labels: data.map(x=>x.d.slice(5)), datasets: [{ label: 'Poids', data: data.map(x=>x.w), borderColor: curUser==='siana'?'#EC4899':'#8B5CF6', tension: 0.4, borderWidth: 3, pointBackgroundColor: 'white', pointRadius: 4 }] },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: { display: true, color: '#f3f4f6' }, ticks: { font: { weight: 'bold' } } }, x: { grid: { display: false } } } }
            });
        }

        render();
    </script>
</body>
</html>
