<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SOFIAN.FIT V7</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;600;800&display=swap');
        
        :root { --bg: #000000; --card: #121212; --red: #ff003c; --blue: #007aff; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg); 
            color: white; 
            height: 100dvh; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
        }

        .font-sport { font-family: 'Orbitron', sans-serif; }
        
        /* ZONE DE CONTENU PRINCIPALE - C'est ici que la correction du scroll se joue */
        .main-content { 
            flex: 1; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
            padding-bottom: 160px; /* Marge √©norme pour que rien ne soit cach√© */
            padding-top: 20px;
        }

        /* HEADER & NAV */
        .glass-header { 
            background: rgba(0,0,0,0.9); 
            border-bottom: 1px solid #222; 
            padding-top: max(env(safe-area-inset-top), 15px);
            padding-bottom: 15px;
            z-index: 50;
        }
        .glass-nav { 
            background: rgba(0,0,0,0.95); 
            border-top: 1px solid #222; 
            padding-bottom: max(env(safe-area-inset-bottom), 20px);
            z-index: 50;
        }

        /* CALENDRIER */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .cal-day { 
            aspect-ratio: 1/1; background: #1a1a1a; border-radius: 8px; 
            display: flex; flex-direction: column; align-items: center; justify-content: start; 
            padding-top: 4px; position: relative; font-size: 11px; font-weight: 700; border: 1px solid transparent;
        }
        .cal-day.selected { border-color: var(--red); background: rgba(255,0,60,0.1); }
        .cal-day.today { color: var(--red); text-decoration: underline; }
        
        .dots { display: flex; gap: 2px; position: absolute; bottom: 4px; }
        .dot { width: 4px; height: 4px; border-radius: 50%; }
        .dot-m { background: var(--red); }
        .dot-c { background: var(--blue); }
        .dot-j { background: #fbbf24; }

        /* INPUTS */
        input, select { 
            background: transparent !important; border: none !important; 
            border-bottom: 1px solid #333 !important; color: white !important; 
            padding: 12px 0 !important; width: 100%; outline: none !important; 
            font-weight: 600; font-size: 16px; border-radius: 0 !important;
        }
        input:focus { border-bottom-color: var(--red) !important; }

        .card { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid #222; margin-bottom: 16px; }
        
        .btn-main { 
            background: var(--red); color: black; font-weight: 900; 
            text-transform: uppercase; padding: 15px; border-radius: 12px; width: 100%; 
        }

        .nav-btn { opacity: 0.4; transition: 0.2s; }
        .nav-active { opacity: 1 !important; color: var(--red); transform: scale(1.1); }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header class="glass-header px-6 flex justify-between items-center sticky top-0">
        <div>
            <h1 class="font-sport text-xl italic tracking-tighter">SOFIAN<span class="text-rose-600">.FIT</span></h1>
            <p id="moto" class="text-[9px] font-black uppercase tracking-widest text-gray-400 mt-1">NO PAIN NO GAIN</p>
        </div>
        <div class="text-[9px] font-black uppercase text-rose-500 border border-rose-900 px-2 py-1 rounded">
            JUNK: <span id="junk-score">0</span>/2
        </div>
    </header>

    <main class="main-content px-4">

        <section id="view-home">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="month-label" class="font-sport text-xs text-blue-500 uppercase"></h2>
                    <div class="flex gap-4 text-xs font-bold text-gray-500">
                        <button onclick="changeMonth(-1)">PREV</button>
                        <button onclick="changeMonth(1)">NEXT</button>
                    </div>
                </div>
                <div class="cal-grid text-center mb-2 text-[9px] font-black opacity-30 uppercase">
                    <span>Lu</span><span>Ma</span><span>Me</span><span>Je</span><span>Ve</span><span>Sa</span><span>Di</span>
                </div>
                <div id="cal-grid" class="cal-grid"></div>
            </div>

            <div class="card">
                <h3 class="text-[10px] font-black uppercase text-gray-400 mb-3">D√©tail du <span id="sel-date-disp" class="text-white">--</span></h3>
                <div id="day-list" class="space-y-2"></div>
            </div>
            
            <div class="h-10"></div>
        </section>

        <section id="view-stats" class="hidden">
            <div class="card">
                <h2 class="font-sport text-sm uppercase text-rose-500 mb-4">Courbe de Poids</h2>
                <div class="relative h-48 w-full">
                    <canvas id="weightChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2 class="text-[10px] font-black uppercase text-gray-400 mb-2">Nouvelle Pes√©e</h2>
                <div class="flex gap-4">
                    <input type="number" id="weight-in" placeholder="Ex: 85.5">
                    <button onclick="addWeight()" class="bg-white text-black font-black px-6 rounded">OK</button>
                </div>
            </div>

            <div class="card">
                <h2 class="text-[10px] font-black uppercase text-gray-400 mb-3">Historique</h2>
                <div id="weight-history" class="space-y-2 max-h-48 overflow-y-auto"></div>
            </div>
        </section>

        <section id="view-add" class="hidden">
            <button onclick="nav('home')" class="mb-4 text-xs font-bold opacity-50">‚Üê RETOUR</button>
            <div class="card space-y-5">
                <h2 class="font-sport text-lg uppercase text-rose-500 italic">Ajouter une entr√©e</h2>
                
                <select id="add-type" onchange="toggleForm()">
                    <option value="muscu">üèãÔ∏è MUSCULATION</option>
                    <option value="cardio">üèÉ CARDIO</option>
                    <option value="junk">üçî FAST FOOD</option>
                </select>

                <input type="text" id="add-name" placeholder="Nom (Squat, Running...)">

                <div id="grp-stats" class="grid grid-cols-2 gap-4">
                    <input type="number" id="add-v1" placeholder="Poids / Mins">
                    <input type="number" id="add-v2" placeholder="Reps">
                </div>

                <button onclick="saveEntry()" class="btn-main mt-4">ENREGISTRER</button>
            </div>
        </section>

    </main>

    <nav class="glass-nav fixed bottom-0 w-full flex justify-between items-center px-8 pt-2">
        <button onclick="nav('home')" id="btn-home" class="nav-btn nav-active flex flex-col items-center">
            <span class="text-2xl">üìÖ</span>
            <span class="text-[9px] font-black uppercase mt-1">Journal</span>
        </button>
        
        <button onclick="nav('add')" id="btn-add" class="bg-rose-600 w-14 h-14 rounded-full flex items-center justify-center -mt-8 shadow-lg shadow-rose-600/50 border-4 border-black z-50">
            <span class="text-3xl font-black text-black">+</span>
        </button>

        <button onclick="nav('stats')" id="btn-stats" class="nav-btn flex flex-col items-center">
            <span class="text-2xl">üìà</span>
            <span class="text-[9px] font-black uppercase mt-1">Stats</span>
        </button>
    </nav>

    <script>
        // --- DATA INIT ---
        let db = JSON.parse(localStorage.getItem('sofian_v7')) || { logs: {}, weights: [] };
        let selDate = new Date().toISOString().split('T')[0];
        let viewDate = new Date();
        let chartInstance = null;

        function save() { localStorage.setItem('sofian_v7', JSON.stringify(db)); render(); }

        // --- NAVIGATION ---
        function nav(view) {
            // Cacher toutes les sections
            document.getElementById('view-home').classList.add('hidden');
            document.getElementById('view-stats').classList.add('hidden');
            document.getElementById('view-add').classList.add('hidden');
            
            // Afficher la bonne
            document.getElementById('view-' + view).classList.remove('hidden');

            // G√©rer les boutons actifs
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active'));
            if(view !== 'add') document.getElementById('btn-' + view).classList.add('nav-active');

            // Si on va sur stats, on force le rendu du graph
            if(view === 'stats') setTimeout(renderChart, 100);
        }

        // --- FORM LOGIC ---
        function toggleForm() {
            const t = document.getElementById('add-type').value;
            const grp = document.getElementById('grp-stats');
            const name = document.getElementById('add-name');
            
            if(t === 'junk') {
                grp.classList.add('hidden');
                name.placeholder = "C'√©tait quoi ?";
            } else {
                grp.classList.remove('hidden');
                name.placeholder = t === 'muscu' ? "Exercice (ex: Bench)" : "Activit√© (ex: Tapis)";
                document.getElementById('add-v2').classList.toggle('hidden', t === 'cardio');
            }
        }

        function saveEntry() {
            const t = document.getElementById('add-type').value;
            const n = document.getElementById('add-name').value;
            if(!n) return alert("Mets un nom !");

            if(!db.logs[selDate]) db.logs[selDate] = [];
            db.logs[selDate].push({
                type: t, name: n,
                v1: document.getElementById('add-v1').value,
                v2: document.getElementById('add-v2').value
            });

            // Reset
            document.getElementById('add-name').value = "";
            document.getElementById('add-v1').value = "";
            document.getElementById('add-v2').value = "";
            save();
            nav('home');
        }

        function addWeight() {
            const w = document.getElementById('weight-in').value;
            if(w) {
                db.weights.push({ d: selDate, v: parseFloat(w) });
                save();
                document.getElementById('weight-in').value = "";
                renderChart(); // Rafraichir le graph direct
            }
        }

        function deleteLog(idx) {
            if(confirm("Supprimer ?")) {
                db.logs[selDate].splice(idx, 1);
                save();
            }
        }

        function changeMonth(dir) {
            viewDate.setMonth(viewDate.getMonth() + dir);
            render();
        }

        // --- RENDER ---
        function render() {
            // 1. Calendrier
            const grid = document.getElementById('cal-grid');
            grid.innerHTML = "";
            const y = viewDate.getFullYear();
            const m = viewDate.getMonth();
            const months = ["JANVIER", "F√âVRIER", "MARS", "AVRIL", "MAI", "JUIN", "JUILLET", "AO√õT", "SEPTEMBRE", "OCTOBRE", "NOVEMBRE", "D√âCEMBRE"];
            document.getElementById('month-label').innerText = `${months[m]} ${y}`;

            const firstDay = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m + 1, 0).getDate();
            const offset = firstDay === 0 ? 6 : firstDay - 1;

            for(let i=0; i<offset; i++) grid.innerHTML += `<div></div>`;

            for(let d=1; d<=daysInMonth; d++) {
                const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const isSel = dStr === selDate ? 'selected' : '';
                const isToday = dStr === new Date().toISOString().split('T')[0] ? 'today' : '';
                
                let dots = "";
                if(db.logs[dStr]) {
                    db.logs[dStr].forEach(l => {
                        if(l.type==='muscu') dots += '<div class="dot dot-m"></div>';
                        else if(l.type==='cardio') dots += '<div class="dot dot-c"></div>';
                        else dots += '<div class="dot dot-j"></div>';
                    });
                }

                grid.innerHTML += `<div onclick="selDate='${dStr}';render()" class="cal-day ${isSel} ${isToday}">${d}<div class="dots">${dots}</div></div>`;
            }

            // 2. D√©tails jour
            document.getElementById('sel-date-disp').innerText = selDate;
            const list = document.getElementById('day-list');
            const logs = db.logs[selDate] || [];
            
            if(logs.length === 0) {
                list.innerHTML = `<div class="text-center opacity-30 text-xs italic py-4">Rien ce jour-l√†. Repos ?</div>`;
            } else {
                list.innerHTML = logs.map((l, i) => {
                    let color = l.type==='muscu' ? 'text-rose-500' : (l.type==='cardio'?'text-blue-500':'text-yellow-500');
                    let icon = l.type==='muscu' ? 'üèãÔ∏è' : (l.type==='cardio'?'üèÉ':'üçî');
                    let detail = l.type==='junk' ? '' : `${l.v1}${l.type=='muscu'?'kg':' min'} ${l.v2?'x '+l.v2:''}`;
                    return `
                        <div class="flex justify-between items-center bg-white/5 p-3 rounded-lg border-l-2 ${l.type==='muscu'?'border-rose-500':(l.type==='cardio'?'border-blue-500':'border-yellow-500')}">
                            <div>
                                <span class="text-[9px] font-black uppercase ${color}">${icon} ${l.type}</span>
                                <div class="font-bold text-sm uppercase">${l.name}</div>
                                <div class="text-[10px] opacity-50 font-sport">${detail}</div>
                            </div>
                            <button onclick="deleteLog(${i})" class="text-white/30 text-xs">√ó</button>
                        </div>
                    `;
                }).join('');
            }

            // 3. Junk Score (7 jours)
            let junk = 0;
            const weekAgo = new Date(); weekAgo.setDate(weekAgo.getDate() - 7);
            Object.keys(db.logs).forEach(k => {
                if(new Date(k) >= weekAgo) db.logs[k].forEach(l => { if(l.type==='junk') junk++; });
            });
            const jEl = document.getElementById('junk-score');
            jEl.innerText = junk;
            jEl.style.color = junk > 2 ? '#ff003c' : 'white';

            // 4. Liste Poids (Historique)
            const wList = document.getElementById('weight-history');
            wList.innerHTML = db.weights.slice().reverse().map(w => `
                <div class="flex justify-between text-xs opacity-60 border-b border-white/5 py-2">
                    <span>${w.d}</span><span>${w.v} kg</span>
                </div>
            `).join('');
        }

        // --- CHART ---
        function renderChart() {
            const ctx = document.getElementById('weightChart');
            if(!ctx) return;
            
            if(chartInstance) chartInstance.destroy();
            
            const data = db.weights.slice().sort((a,b) => new Date(a.d) - new Date(b.d)).slice(-10);

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.d.substring(5)), // MM-DD
                    datasets: [{
                        label: 'Poids',
                        data: data.map(d => d.v),
                        borderColor: '#ff003c',
                        borderWidth: 3,
                        pointBackgroundColor: '#000',
                        pointBorderColor: '#ff003c',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#555' } },
                        y: { grid: { color: '#222' }, ticks: { color: '#555' } }
                    }
                }
            });
        }

        // Init
        toggleForm();
        render();
    </script>
</body>
</html>
