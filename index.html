<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SOFIAN.FIT - ULTIMATE</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;600;900&display=swap');
        :root { --bg: #000000; --card: #0d0d0d; --accent: #ff003c; --blue: #0084ff; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; height: 100dvh; overflow: hidden; display: flex; flex-direction: column; }
        .font-sport { font-family: 'Orbitron', sans-serif; }
        .view-container { flex: 1; overflow-y: auto; padding-bottom: 200px !important; }
        .glass { background: rgba(0,0,0,0.85); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }
        
        /* CALENDRIER FRANCAIS */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .cal-day { aspect-ratio: 1/1; border-radius: 12px; background: #121212; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; font-weight: 800; border: 1px solid transparent; position: relative; }
        .cal-day.active { border-color: var(--accent); background: rgba(255,0,60,0.1); }
        .cal-today { color: var(--accent); text-decoration: underline; }
        .event-dot { width: 4px; height: 4px; background: var(--blue); border-radius: 50%; position: absolute; bottom: 4px; }

        /* INPUTS DESIGN */
        input, select { background: transparent !important; border: none !important; border-bottom: 1px solid rgba(255,255,255,0.1) !important; color: white !important; padding: 10px 0 !important; width: 100%; outline: none !important; font-size: 15px; }
        input:focus { border-bottom-color: var(--accent) !important; }
        
        .card { background: var(--card); border-radius: 24px; border: 1px solid rgba(255,255,255,0.05); padding: 20px; }
        .btn-main { background: var(--accent); color: black; font-weight: 900; text-transform: uppercase; padding: 16px; border-radius: 15px; width: 100%; font-size: 12px; transition: 0.2s; }
        .btn-main:active { transform: scale(0.95); opacity: 0.8; }
        .nav-active { color: var(--accent); transform: scale(1.1); opacity: 1 !important; }
    </style>
</head>
<body>

    <header class="pt-14 pb-4 px-6 glass sticky top-0 z-50 flex justify-between items-center">
        <div>
            <h1 class="font-sport text-xl italic">SOFIAN<span class="text-rose-600">.FIT</span></h1>
            <p id="motivation-msg" class="text-[9px] font-black text-rose-500 uppercase tracking-widest mt-1">ON Y CROIT SOFIAN !</p>
        </div>
        <div class="bg-rose-600 text-black px-3 py-1 rounded-full font-sport text-xs" id="streak-count">0 üî•</div>
    </header>

    <main class="view-container p-4 space-y-6">

        <section id="view-dash" class="space-y-6">
            <div class="card">
                <div class="flex justify-between items-center mb-4 px-2">
                    <span id="current-month-label" class="text-xs font-black uppercase text-blue-500 font-sport">F√âVRIER 2026</span>
                    <div class="flex gap-4 opacity-40 text-xs">
                        <button onclick="changeMonth(-1)">‚Üê</button>
                        <button onclick="changeMonth(1)">‚Üí</button>
                    </div>
                </div>
                <div class="cal-grid text-[9px] font-black opacity-30 uppercase mb-2 text-center">
                    <span>Lu</span><span>Ma</span><span>Me</span><span>Je</span><span>Ve</span><span>Sa</span><span>Di</span>
                </div>
                <div id="calendar-body" class="cal-grid text-center"></div>
            </div>

            <div class="card border-l-4 border-rose-600 flex justify-between items-center">
                <div>
                    <h2 class="text-[10px] font-black opacity-40 uppercase">Fast Food (Max 2/sem)</h2>
                    <p class="text-3xl font-sport" id="junk-val">0</p>
                </div>
                <button onclick="promptJunk()" class="w-12 h-12 bg-white/5 rounded-2xl text-2xl">üçî</button>
            </div>

            <div class="card">
                <canvas id="weightChart" height="180"></canvas>
            </div>
        </section>

        <section id="view-sport" class="hidden space-y-6">
            <div class="card space-y-4">
                <h3 class="text-xs font-black text-rose-500 uppercase italic">Log S√©ance : <span id="target-date">--</span></h3>
                <select id="ex-type" onchange="toggleFields()">
                    <option value="muscu">üèãÔ∏è MUSCULATION</option>
                    <option value="cardio">üèÉ CARDIO / COURSE</option>
                </select>
                <input type="text" id="ex-name" placeholder="Nom (Squat, Tapis, For√™t...)">
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="ex-val1" placeholder="Poids / Mins">
                    <input type="number" id="ex-val2" placeholder="Reps (si muscu)">
                </div>
                <div class="flex gap-2">
                    <input type="time" id="ex-time" value="18:00" class="w-1/3">
                    <button onclick="saveSport()" class="btn-main flex-1">Enregistrer</button>
                </div>
            </div>
            <div id="day-list" class="space-y-2"></div>
        </section>

        <section id="view-weight" class="hidden space-y-4">
            <div class="card text-center">
                <h2 class="text-xs font-black opacity-40 uppercase mb-4">Mise √† jour Poids</h2>
                <div class="flex gap-4 items-end">
                    <input type="number" id="weight-in" placeholder="Kg" class="text-center font-sport text-3xl">
                    <button onclick="addWeight()" class="btn-main w-24">OK</button>
                </div>
            </div>
            <div id="weight-list" class="space-y-2"></div>
        </section>

    </main>

    <nav class="glass fixed bottom-0 w-full z-50 pt-4 pb-10 px-6 flex justify-around items-center border-t border-white/5">
        <button onclick="showTab('dash', this)" class="nav-item nav-active opacity-40 flex flex-col items-center">
            <span class="text-2xl">üè†</span>
            <span class="text-[8px] font-black mt-1 uppercase tracking-widest">Home</span>
        </button>
        <button onclick="showTab('sport', this)" class="nav-item opacity-40 flex flex-col items-center">
            <span class="text-2xl">üèãÔ∏è</span>
            <span class="text-[8px] font-black mt-1 uppercase tracking-widest">Sport</span>
        </button>
        <button onclick="showTab('weight', this)" class="nav-item opacity-40 flex flex-col items-center">
            <span class="text-2xl">‚öñÔ∏è</span>
            <span class="text-[8px] font-black mt-1 uppercase tracking-widest">Poids</span>
        </button>
    </nav>

    <script>
        let db = JSON.parse(localStorage.getItem('sofian_final_final')) || {
            days: {}, weights: [], junk: [], streak: 0
        };

        const quotes = ["ON Y CROIT SOFIAN !", "T'ES UNE MACHINE !", "LAISSE PAS LE MCDO GAGNER !", "CHAQUE S√âANCE COMPTE !"];
        let selDate = new Date().toISOString().split('T')[0];
        let displayMonth = new Date();

        function save() { localStorage.setItem('sofian_final_final', JSON.stringify(db)); render(); }

        function showTab(id, btn) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('view-' + id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active'));
            btn.classList.add('nav-active');
        }

        function toggleFields() {
            const type = document.getElementById('ex-type').value;
            document.getElementById('ex-val2').classList.toggle('hidden', type === 'cardio');
        }

        function promptJunk() {
            const f = prompt("C'√©tait quoi le craquage ? (Sois franc !)");
            if(f) { db.junk.push({ d: selDate, f: f }); save(); }
        }

        function saveSport() {
            const name = document.getElementById('ex-name').value;
            if(!name) return;
            if(!db.days[selDate]) db.days[selDate] = [];
            db.days[selDate].push({
                t: document.getElementById('ex-type').value,
                n: name,
                v1: document.getElementById('ex-val1').value,
                v2: document.getElementById('ex-val2').value,
                h: document.getElementById('ex-time').value
            });
            document.getElementById('ex-name').value = "";
            save();
        }

        function addWeight() {
            const v = document.getElementById('weight-in').value;
            if(v) { db.weights.push({ d: selDate, v: parseFloat(v) }); save(); }
            document.getElementById('weight-in').value = "";
        }

        function changeMonth(v) { displayMonth.setMonth(displayMonth.getMonth() + v); render(); }

        function render() {
            document.getElementById('motivation-msg').innerText = quotes[Math.floor(Math.random()*quotes.length)];
            document.getElementById('target-date').innerText = selDate;
            
            // Calendrier
            const body = document.getElementById('calendar-body');
            body.innerHTML = "";
            const y = displayMonth.getFullYear();
            const m = displayMonth.getMonth();
            const months = ["JANVIER", "F√âVRIER", "MARS", "AVRIL", "MAI", "JUIN", "JUILLET", "AO√õT", "SEPTEMBRE", "OCTOBRE", "NOVEMBRE", "D√âCEMBRE"];
            document.getElementById('current-month-label').innerText = `${months[m]} ${y}`;

            const firstDay = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m + 1, 0).getDate();
            const offset = firstDay === 0 ? 6 : firstDay - 1;

            for(let i=0; i<offset; i++) body.innerHTML += `<div></div>`;
            for(let d=1; d<=daysInMonth; d++) {
                const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const hasSport = db.days[dStr] && db.days[dStr].length > 0;
                const isSel = dStr === selDate ? 'active' : '';
                const isToday = dStr === new Date().toISOString().split('T')[0] ? 'cal-today' : '';
                body.innerHTML += `<div onclick="selDate='${dStr}';render()" class="cal-day ${isSel} ${isToday}">${d}${hasSport?'<div class="event-dot"></div>':''}</div>`;
            }

            // Junk Food (7 jours glissants)
            const weekJunk = db.junk.filter(j => (new Date() - new Date(j.d)) / 86400000 <= 7).length;
            document.getElementById('junk-val').innerText = weekJunk + " / 2";
            document.getElementById('junk-val').style.color = weekJunk > 2 ? '#ff003c' : 'white';

            // Lists
            document.getElementById('day-list').innerHTML = (db.days[selDate] || []).map(ex => `
                <div class="card flex justify-between items-center py-3 bg-white/5 border-none">
                    <div>
                        <span class="text-rose-500 font-sport text-[10px] mr-2">${ex.h}</span>
                        <span class="font-bold text-sm uppercase">${ex.n}</span>
                    </div>
                    <span class="text-xs font-sport">${ex.v1}${ex.t=='muscu'?'kg':' min'}</span>
                </div>
            `).join('');

            document.getElementById('weight-list').innerHTML = db.weights.slice(-5).reverse().map(w => `
                <div class="card py-2 flex justify-between opacity-50 text-xs"><span>${w.d}</span><span>${w.v} kg</span></div>
            `).join('');

            updateChart();
        }

        function updateChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            if(window.wChart) window.wChart.destroy();
            const d = db.weights.slice(-7);
            window.wChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: d.map(x => x.d.split('-')[2]),
                    datasets: [{ data: d.map(x => x.v), borderColor: '#ff003c', borderWidth: 3, tension: 0.4, pointRadius: 0 }]
                },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false }, ticks: { color: '#444' } } } }
            });
        }

        render();
    </script>
</body>
</html>
